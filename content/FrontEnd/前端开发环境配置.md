---
title: 'å‰ç«¯å¼€å‘ç¯å¢ƒé…ç½®'
description: ''
categories: []
tags: []
date: 2024-07
---

## ä½¿ç”¨ fnm ç®¡ç† node ç‰ˆæœ¬

- [GitHub - Schniz/fnm: ğŸš€ Fast and simple Node.js version manager, built in Rust](https://github.com/Schniz/fnm)
- [Node.js â€” ä¸‹è½½ Node.jsÂ® (nodejs.org)](https://nodejs.org/zh-cn/download/package-manager)

### å®‰è£…

```shell
winget install Schniz.fnm
fnm --version
```

### é…ç½®

- å¼€å¯ç‰ˆæœ¬è‡ªåŠ¨åˆ‡æ¢ (æ ¹æ® `.node-version`ã€`.nvmrc`ã€`packages.json#engines#node` åˆ¤æ–­)ï¼š

```shell
# æ‰“å° profile æ–‡ä»¶ä½ç½®
echo $profile
# æ·»åŠ å¦‚ä¸‹ä¸€è¡Œ
fnm env --use-on-cd | Out-String | Invoke-Expression
```

- é‡å¯ powershell å¦‚æœæŠ¥é”™ï¼Œåˆ™æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š  
  å‚è€ƒï¼š[å…³äºæ‰§è¡Œç­–ç•¥ - PowerShell | Microsoft Learn](https://learn.microsoft.com/zh-cn/powershell/module/microsoft.powershell.core/about/about_execution_policies?view=powershell-7.4)

```shell
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
```

- é…ç½®ç¯å¢ƒå˜é‡ï¼ˆä½¿ç”¨ç®¡ç†å‘˜æ‰§è¡Œï¼Œå¦åˆ™é…ç½®çš„æ˜¯ç”¨æˆ·å˜é‡ï¼‰ï¼š

```shell
# é…ç½® node é•œåƒåœ°å€
setx "FNM_NODE_DIST_MIRROR" "https://mirrors.tuna.tsinghua.edu.cn/nodejs-release/"
# é…ç½® node å®‰è£…ç›®å½•
setx "FNM_DIR" "C:\DevKit\nodejs"
```

- å®‰è£… node å¹¶ä½¿ç”¨ï¼š

```shell
# å®‰è£…æŒ‡å®šç‰ˆæœ¬
fnm install 18
fnm install 20
# åˆ—å‡ºè¿œç¨‹
fnm list-remote
# åˆ—å‡ºæœ¬åœ°å·²å®‰è£…
fnm list
# æŒ‡å®šé»˜è®¤ä½¿ç”¨ç‰ˆæœ¬
fnm default 18
# åˆ‡æ¢ä½¿ç”¨ç‰ˆæœ¬
fnm use 20
```

---

## npm é…ç½®

å‚è€ƒï¼š[Node.jså®‰è£…ä¸é…ç½®ï¼ˆè¯¦ç»†æ­¥éª¤ï¼‰_nodejså®‰è£…åŠç¯å¢ƒé…ç½®_liyitongxueçš„åšå®¢-CSDNåšå®¢](https://blog.csdn.net/qq_42006801/article/details/124830995)

```shell
npm config set prefix "C:\DevKit\nodejs\node_global"
npm config set cache "C:\DevKit\nodejs\node_cache"
npm config set registry https://registry.npm.taobao.org
```

ç›¸å½“äºåœ¨åŠ ç›®å½•ä¸‹åˆ›å»º `.npmrc` æ–‡ä»¶ï¼š

```properties
cache=C:\DevKit\nodejs\node_cache
prefix=C:\DevKit\nodejs\node_global
registry=https://registry.npm.taobao.org
```

ä¿®æ”¹åï¼Œæ‰‹åŠ¨é…ç½® NODE_HOMEã€NODE_GLOBAL ç¯å¢ƒå˜é‡ï¼Œå¹¶æ·»åŠ è¿› Path ä¸­ã€‚

ä»¥ä¸‹æ˜¯ `npm install` å‘½ä»¤çš„ä¸€äº›å¸¸ç”¨é€‰é¡¹åŠå…¶å«ä¹‰ï¼š

- `--save` æˆ– `-S`ï¼šå°†åŒ…æ·»åŠ åˆ° `package.json` æ–‡ä»¶çš„ `dependencies` éƒ¨åˆ†ï¼Œå¹¶å°†å…¶å®‰è£…åœ¨ `node_modules` æ–‡ä»¶å¤¹ä¸­ï¼›(**é»˜è®¤**)
  - å®‰è£…å‰ç«¯å¼€å‘ä¾èµ–çš„ç»„ä»¶æ—¶ä½¿ç”¨ï¼Œä¾‹å¦‚ element-uiã€echarts ...
- `--save-dev` æˆ– `-D`ï¼šå°†åŒ…æ·»åŠ åˆ° `package.json` æ–‡ä»¶çš„ `devDependencies` éƒ¨åˆ†ï¼Œå¹¶å°†å…¶å®‰è£…åœ¨ `node_modules` æ–‡ä»¶å¤¹ä¸­ï¼›
  - å®‰è£…ä¸€äº›æ‰“åŒ…å·¥å…·æ—¶ä½¿ç”¨ï¼Œä¾‹å¦‚ webpackã€babel ...
- `--global` æˆ– `-g`ï¼šå°†åŒ…å®‰è£…ä¸ºå…¨å±€åŒ…ï¼Œå³ `node_global` æ–‡ä»¶å¤¹ä¸­ï¼›
  - ä¾‹å¦‚ vue-cli ...
- `--production`ï¼šåªå®‰è£… `dependencies` éƒ¨åˆ†ä¸­åˆ—å‡ºçš„åŒ…ï¼Œè€Œä¸å®‰è£… `devDependencies` éƒ¨åˆ†ä¸­åˆ—å‡ºçš„åŒ…ã€‚

---

## Vite é…ç½®

- å‚è€ƒï¼š[Vite | ä¸‹ä¸€ä»£çš„å‰ç«¯å·¥å…·é“¾ (vitejs.dev)](https://cn.vitejs.dev/)

### ç¯å¢ƒå˜é‡

Vite åœ¨ä¸€ä¸ªç‰¹æ®Šçš„Â `import.meta.env`Â å¯¹è±¡ä¸Šæš´éœ²ç¯å¢ƒå˜é‡ï¼Œä¾‹å¦‚ï¼š

- `import.meta.env.BASE_URL`ï¼šéƒ¨ç½²åº”ç”¨æ—¶çš„åŸºæœ¬ URLï¼›
- `import.meta.env.MODE`ï¼šåº”ç”¨è¿è¡Œçš„æ¨¡å¼ï¼›
- `import.meta.env.DEV`ï¼šåº”ç”¨æ˜¯å¦è¿è¡Œåœ¨å¼€å‘ç¯å¢ƒï¼›
- `import.meta.env.PROD`ï¼šåº”ç”¨æ˜¯å¦è¿è¡Œåœ¨ç”Ÿäº§ç¯å¢ƒï¼›

æ„å»ºæ—¶è¿™äº›å˜é‡ä¼šè¢«é™æ€æ›¿æ¢ï¼Œå› æ­¤**ä¸èƒ½**ä¼å›¾åŠ¨æ€å–å€¼ä¾‹å¦‚ `import.meta.env[key]`ã€‚  
å¦‚æœä¸æƒ³è¢«æ›¿æ¢ (æœ‰æ—¶æœŸæœ›åŸæ ·è¾“å‡º)ï¼Œå¯ä»¥ä½¿ç”¨é›¶å®½å­—ç¬¦ `import.meta\u200b.env.MODE`ã€‚

å¯ä»¥é€šè¿‡ `.env` åŠ è½½é¢å¤–çš„ç¯å¢ƒå˜é‡ï¼Œè¿™äº›ç¯å¢ƒå˜é‡ä¹Ÿä¼šé€šè¿‡Â `import.meta.env`Â ä»¥å­—ç¬¦ä¸²å½¢å¼æš´éœ²ç»™å®¢æˆ·ç«¯æºç  (ä¸ºäº†å®‰å…¨é»˜è®¤åªä¼šæš´éœ²ä»¥ `VITE_` å¼€å¤´çš„ç¯å¢ƒå˜é‡)ã€‚

```shell
.env                # æ‰€æœ‰æƒ…å†µä¸‹éƒ½ä¼šåŠ è½½
.env.local          # æ‰€æœ‰æƒ…å†µä¸‹éƒ½ä¼šåŠ è½½ï¼Œä½†ä¼šè¢« git å¿½ç•¥
.env.[mode]         # åªåœ¨æŒ‡å®šæ¨¡å¼ä¸‹åŠ è½½
.env.[mode].local   # åªåœ¨æŒ‡å®šæ¨¡å¼ä¸‹åŠ è½½ï¼Œä½†ä¼šè¢« git å¿½ç•¥
```

`.local` çš„æ„ä¹‰æ˜¯ç”¨äºé…ç½®æ¯ä¸ªå¼€å‘äººå‘˜æœ¬åœ°ä¸åŒçš„ç¯å¢ƒå˜é‡ï¼Œæ•…ä¸è¦ä¸Šä¼  gitã€‚

æ‰§è¡Œ vite å‘½ä»¤æ—¶ï¼Œä½¿ç”¨ `--mode xxx` æ¥æŒ‡å®š modeï¼Œé»˜è®¤ `'development'`Â ç”¨äºå¼€å‘ï¼Œ`'production'`Â ç”¨äºæ„å»ºã€‚

### é…ç½®

æ‰§è¡Œ vite å‘½ä»¤æ—¶ï¼Œè‡ªåŠ¨å¯»æ‰¾å½“å‰ç›®å½•ä¸‹çš„ `vite.config.js` æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ `--config` å‚æ•°æŒ‡å®šé…ç½®æ–‡ä»¶ï¼š

```shell
vite --config my-config.js
```

åœ¨é…ç½®æ–‡ä»¶ä¸­å¯ä»¥é€šè¿‡ `loadEnv` åŠ è½½ç¯å¢ƒå˜é‡ï¼š

```js
import { defineConfig, loadEnv } from 'vite'

export default defineConfig(({ command, mode }) => {
  // æ ¹æ®å½“å‰å·¥ä½œç›®å½•ä¸­çš„ `mode` åŠ è½½ .env æ–‡ä»¶
  // è®¾ç½®ç¬¬ä¸‰ä¸ªå‚æ•°ä¸º '' æ¥åŠ è½½æ‰€æœ‰ç¯å¢ƒå˜é‡ï¼Œè€Œä¸ç®¡æ˜¯å¦æœ‰ `VITE_` å‰ç¼€ã€‚
  const env = loadEnv(mode, process.cwd(), '')
  return {
    // vite é…ç½®
    define: {
      __APP_ENV__: env.APP_ENV
    }
  }
})
```

é…ç½®é¡¹å‚è€ƒï¼š[å…±äº«é…ç½® | Vite å®˜æ–¹ä¸­æ–‡æ–‡æ¡£ (vitejs.cn)](https://vitejs.cn/vite3-cn/config/shared-options.html)

- vite.config.js

```js
import { defineConfig, loadEnv } from 'vite'

import baseConfig from './config/vite.base.config.js'
import devConfig from './config/vite.dev.config.js'
import prodConfig from './config/vite.prod.config.js'

// æ ¹æ®å½“å‰ç¯å¢ƒæ‹¼æ¥é…ç½®æ–‡ä»¶
const envResolver = {
  serve: () => {
    console.log('å¼€å‘ç¯å¢ƒ...')
    return { ...baseConfig, ...devConfig }
  },
  build: () => {
    console.log('ç”Ÿäº§ç¯å¢ƒ...')
    return { ...baseConfig, ...prodConfig }
  }
}

// https://vitejs.dev/config/
export default defineConfig(({ command, mode }) => {
  console.log('command: ', command)
  console.log('mode: ', mode)
  // const env = loadEnv(mode, `${process.cwd()}\\config`, '')
  // console.log(env)
  return envResolver[command]()
})

```

- vite.base.config.js

```js
import { fileURLToPath, URL } from 'node:url'

import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'
import legacy from '@vitejs/plugin-legacy'
import AutoImport from 'unplugin-auto-import/vite'
import { ElementPlusResolver } from 'unplugin-vue-components/dist/resolvers.js'
import Components from 'unplugin-vue-components/dist/vite.js'

// https://vitejs.dev/config/
export default defineConfig({
  // å¼€å‘æˆ–ç”Ÿäº§ç¯å¢ƒæœåŠ¡çš„å…¬å…±åŸºç¡€è·¯å¾„
  base: '/',
  // ç¯å¢ƒå˜é‡æ–‡ä»¶çš„ä½ç½®
  envDir: 'config',
  // ä»¥ envPrefix å¼€å¤´çš„ç¯å¢ƒå˜é‡ä¼šé€šè¿‡ import.meta.env æš´éœ²åœ¨ä½ çš„å®¢æˆ·ç«¯æºç ä¸­ã€‚
  // ä¸åº”è¢«è®¾ç½®ä¸ºç©ºå­—ç¬¦ä¸² ''ï¼Œè¿™å°†æš´éœ²ä½ æ‰€æœ‰çš„ç¯å¢ƒå˜é‡ï¼Œå¯¼è‡´æ•æ„Ÿä¿¡æ¯çš„æ„å¤–æ³„æ¼ã€‚
  // envPrefix: 'VITE_',
  resolve: {
    alias: {
      '@': fileURLToPath(new URL('../src', import.meta.url))
    }
  },
  // æ”¾åœ¨ public æ–‡ä»¶å¤¹ä¸­çš„èµ„æºæ‰“åŒ…æ—¶å°†ä¼šè¢«åŸæ ·å¤åˆ¶ï¼Œè®¾ç½®ä¸º false ç¦ç”¨
  publicDir: 'public',
  plugins: [
    // æä¾› Vue 3 å•æ–‡ä»¶ç»„ä»¶æ”¯æŒ
    vue(),
    // ä¸ºæ‰“åŒ…åçš„æ–‡ä»¶æä¾›ä¼ ç»Ÿæµè§ˆå™¨å…¼å®¹æ€§æ”¯æŒ
    legacy({
      targets: ['defaults', 'not IE 11']
    }),
    AutoImport({
      resolvers: [ElementPlusResolver()]
    }),
    Components({
      resolvers: [ElementPlusResolver()]
    })
  ],
  css: {
    preprocessorOptions: {
      less: {
        math: 'always'
      },
      sass: {}
    }
  },
  build: {
    target: 'modules',
    outDir: 'dist',
    assetsDir: 'assets',
    cssCodeSplit: true,
    sourcemap: false,
    minify: 'terser',
    emptyOutDir: true,
    terserOptions: {
      compress: {
        drop_console: true,
        drop_debugger: true
      }
    }
  }
})

```

- vite.dev.config.js

```js
import { defineConfig } from 'vite'

export default defineConfig({
  server: {
    host: '0.0.0.0',
    port: 8080,
    open: false,
    strictPort: true, // å¦‚æœç«¯å£è¢«å ç”¨åˆ™å¯åŠ¨å¤±è´¥ï¼Œè€Œä¸æ˜¯é¡ºå»¶ç«¯å£å·
    https: false,
    cors: true,
    // https://vitejs.cn/vite3-cn/config/server-options.html#server-proxy
    proxy: {
      '/api': {
        target: 'http://localhost:18081',
        changeOrigin: true
        // rewrite: (path) => path.replace(/^\/api/, 'gateway')
      }
    }
  }
})

```

- vite.prod.config.js

```js
import { defineConfig } from 'vite'

export default defineConfig({
  build: {
    // æŒ‡å®šè¾“å‡ºè·¯å¾„ï¼Œç›¸å¯¹äºé¡¹ç›®æ ¹ç›®å½•
    outDir: 'dist',
    // æŒ‡å®šç”Ÿæˆé™æ€èµ„æºçš„å­˜æ”¾è·¯å¾„ï¼Œç›¸å¯¹äº build.outDir
    assetsDir: 'assets',
    // å°äºæ­¤é˜ˆå€¼çš„å¯¼å…¥æˆ–å¼•ç”¨èµ„æºå°†å†…è”ä¸º base64 ç¼–ç ï¼Œä»¥é¿å…é¢å¤–çš„ http è¯·æ±‚ï¼Œå•ä½ Byte
    assetsInlineLimit: 4096
  }
})

```

### plugin-legacy æ’ä»¶

ç”¨äºè§£å†³æµè§ˆå™¨å…¼å®¹æ€§ã€‚

```shell
npm install -D @vitejs/plugin-legacy
```

```js
// vite.config.js
import legacy from '@vitejs/plugin-legacy'

export default {
  plugins: [
    legacy({
      targets: ['defaults', 'not IE 11'],
    }),
  ],
}
```
